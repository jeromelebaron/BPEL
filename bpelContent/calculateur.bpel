<!-- calculateur BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue Apr 26 16:25:12 CEST 2016 -->
<bpel:process name="calculateur"
	targetNamespace="http://calcul.bpel.jerome.atod26.afcepf.fr"
	suppressJoinFailure="yes" xmlns:tns="http://calcul.bpel.jerome.atod26.afcepf.fr"
	xmlns:ns1="http://calculateur.bpel.jerome.atod26.afcepf.fr" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable">

	<!-- Import the client WSDL -->
	<bpel:import location="calculateurArtifacts.wsdl"
		namespace="http://calcul.bpel.jerome.atod26.afcepf.fr" importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="calculateur.wsdl"
		namespace="http://calculateur.bpel.jerome.atod26.afcepf.fr"
		importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:calculateur"
			myRole="calculateurProvider" />
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="calculateurWS"
			partnerLinkType="ns1:calculateurWebService" partnerRole="calculateurWebServiceProvider" />
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="tns:calculateurRequestMessage" />
		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output" messageType="tns:calculateurResponseMessage" />

		<bpel:variable name="multiplicationInput" messageType="ns1:multiplier" />
		<bpel:variable name="multiplicationOutput" messageType="ns1:multiplierResponse" />

		<bpel:variable name="additionInput" messageType="ns1:ajouter"></bpel:variable>
		<bpel:variable name="additionOutput" messageType="ns1:ajouterResponse"></bpel:variable>
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in calculateur.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:calculateur" operation="process" variable="input"
			createInstance="yes" />
		<!-- A la main <bpel:assign> <bpel:copy> <bpel:from>1</bpel:from> <bpel:to>$output.payload/tns:result</bpel:to> 
			</bpel:copy> </bpel:assign> -->

		
        <bpel:assign validate="no" name="AssignPreparationMutliplication">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:multiplier xmlns:tns="http://calculateur.bpel.jerome.atod26.afcepf.fr" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <premierMultiplication>0.0</premierMultiplication>
  <deuxiemeMultiplication>0.0</deuxiemeMultiplication>
</tns:multiplier>
</bpel:literal></bpel:from>
                <bpel:to variable="multiplicationInput" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:premier]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="multiplicationInput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[premierMultiplication]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:deuxieme]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="multiplicationInput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[deuxiemeMultiplication]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:invoke name="InvokeMultiplication" partnerLink="calculateurWS" operation="multiplier" portType="ns1:ICalculateurService" inputVariable="multiplicationInput" outputVariable="multiplicationOutput"></bpel:invoke>
        <bpel:assign validate="no" name="AssignPreparationAddition">
            
            <bpel:copy>
                <bpel:from><bpel:literal><tns:ajouter xmlns:tns="http://calculateur.bpel.jerome.atod26.afcepf.fr" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <premierAddition>0.0</premierAddition>
  <deuxiemeAddition>0.0</deuxiemeAddition>
</tns:ajouter>
</bpel:literal></bpel:from>
                <bpel:to variable="additionInput" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="multiplicationOutput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[resultatMultiplication]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="additionInput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[premierAddition]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:troisieme]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="additionInput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[deuxiemeAddition]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:invoke name="InvokeAddition" partnerLink="calculateurWS" operation="ajouter" portType="ns1:ICalculateurService" inputVariable="additionInput" outputVariable="additionOutput"></bpel:invoke>
        <bpel:assign validate="no" name="AssignPreparationResultat">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:calculateurResponse xmlns:tns="http://calcul.bpel.jerome.atod26.afcepf.fr" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>0.0</tns:result>
</tns:calculateurResponse>
</bpel:literal></bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="additionOutput">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[resultatAddition]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:result]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:calculateur" operation="process" variable="output" />
	</bpel:sequence>
</bpel:process>

